# SPDX-License-Identifier: GPL-2.0
#
# Makefile for Sphinx documentation
# This was not generated by sphinx-quickstart, but nonetheless copies some
# of its variable name conventions for easier integration with existing tooling

SPHINXBUILD   = sphinx-build
SPHINXOPTS    =

# Internal variables.
ALLSPHINXOPTS   =  $(SPHINXOPTS)

srctree ?= $(realpath $(dir $(lastword $(MAKEFILE_LIST)))/..)
objtree ?= $(srctree)

docs: htmldocs FORCE

htmldocs: gen_commands gen_magicvars FORCE
	@$(SPHINXBUILD) -b html -d $(objtree)/doctrees $(srctree)/Documentation \
		$(objtree)/Documentation/html $(ALLSPHINXOPTS)

gen_commands: FORCE
	@mkdir -p $(srctree)/Documentation/commands
	@$(srctree)/Documentation/gen_commands.py $(srctree) $(srctree)/Documentation/commands

gen_magicvars: FORCE
	@$(srctree)/Documentation/gen_magicvars.py $(srctree) $(srctree)/Documentation/user/magicvars.rst

dochelp: FORCE
	@echo  ' barebox internal documentation from ReST:'
	@echo  '  htmldocs        - HTML'
	@echo  '  docs            - alias for htmldocs'
	@echo
	@echo  '  Default location for the generated documents is Documentation/html'


PHONY += FORCE
FORCE:

.PHONY: $(PHONY)
